aleksey@first:~/OtusTeam/IaC/les10/ans_in_tf$ rm inv
aleksey@first:~/OtusTeam/IaC/les10/ans_in_tf$ tf apply

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # yandex_compute_instance.vm4ans will be created
  + resource "yandex_compute_instance" "vm4ans" {
      + created_at                = (known after apply)
      + folder_id                 = (known after apply)
      + fqdn                      = (known after apply)
      + gpu_cluster_id            = (known after apply)
      + hostname                  = (known after apply)
      + id                        = (known after apply)
      + maintenance_grace_period  = (known after apply)
      + maintenance_policy        = (known after apply)
      + metadata                  = {
          + "ssh-keys" = (sensitive value)
        }
      + name                      = "vm4ans"
      + network_acceleration_type = "standard"
      + platform_id               = "standard-v1"
      + service_account_id        = (known after apply)
      + status                    = (known after apply)
      + zone                      = "ru-central1-a"

      + boot_disk {
          + auto_delete = true
          + device_name = (known after apply)
          + disk_id     = (known after apply)
          + mode        = (known after apply)

          + initialize_params {
              + block_size  = (known after apply)
              + description = (known after apply)
              + image_id    = "fd8pecdhv50nec1qf9im"
              + name        = (known after apply)
              + size        = (known after apply)
              + snapshot_id = (known after apply)
              + type        = "network-hdd"
            }
        }

      + metadata_options (known after apply)

      + network_interface {
          + index              = (known after apply)
          + ip_address         = (known after apply)
          + ipv4               = true
          + ipv6               = (known after apply)
          + ipv6_address       = (known after apply)
          + mac_address        = (known after apply)
          + nat                = true
          + nat_ip_address     = (known after apply)
          + nat_ip_version     = (known after apply)
          + security_group_ids = (known after apply)
          + subnet_id          = (known after apply)
        }

      + placement_policy (known after apply)

      + resources {
          + core_fraction = 100
          + cores         = 2
          + memory        = 2
        }

      + scheduling_policy (known after apply)
    }

  # yandex_vpc_network.net4ans will be created
  + resource "yandex_vpc_network" "net4ans" {
      + created_at                = (known after apply)
      + default_security_group_id = (known after apply)
      + folder_id                 = (known after apply)
      + id                        = (known after apply)
      + labels                    = (known after apply)
      + name                      = "net4ans"
      + subnet_ids                = (known after apply)
    }

  # yandex_vpc_subnet.sub4ans will be created
  + resource "yandex_vpc_subnet" "sub4ans" {
      + created_at     = (known after apply)
      + folder_id      = (known after apply)
      + id             = (known after apply)
      + labels         = (known after apply)
      + name           = "sub4ans"
      + network_id     = (known after apply)
      + v4_cidr_blocks = [
          + "10.2.0.0/16",
        ]
      + v6_cidr_blocks = (known after apply)
      + zone           = "ru-central1-a"
    }

Plan: 3 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + ansible_inventory = (known after apply)

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

yandex_vpc_network.net4ans: Creating...
yandex_vpc_network.net4ans: Creation complete after 1s [id=enpldvsit81gudhimkmm]
yandex_vpc_subnet.sub4ans: Creating...
yandex_vpc_subnet.sub4ans: Creation complete after 0s [id=e9b04lkhslb00c82v2r9]
yandex_compute_instance.vm4ans: Creating...
yandex_compute_instance.vm4ans: Still creating... [10s elapsed]
yandex_compute_instance.vm4ans: Still creating... [20s elapsed]
yandex_compute_instance.vm4ans: Still creating... [30s elapsed]
yandex_compute_instance.vm4ans: Provisioning with 'remote-exec'...
yandex_compute_instance.vm4ans (remote-exec): Connecting to remote host via SSH...
yandex_compute_instance.vm4ans (remote-exec):   Host: 62.84.125.140
yandex_compute_instance.vm4ans (remote-exec):   User: ubuntu
yandex_compute_instance.vm4ans (remote-exec):   Password: false
yandex_compute_instance.vm4ans (remote-exec):   Private key: true
yandex_compute_instance.vm4ans (remote-exec):   Certificate: false
yandex_compute_instance.vm4ans (remote-exec):   SSH Agent: false
yandex_compute_instance.vm4ans (remote-exec):   Checking Host Key: false
yandex_compute_instance.vm4ans (remote-exec):   Target Platform: unix
yandex_compute_instance.vm4ans: Still creating... [40s elapsed]
yandex_compute_instance.vm4ans: Still creating... [50s elapsed]
yandex_compute_instance.vm4ans (remote-exec): Connecting to remote host via SSH...
yandex_compute_instance.vm4ans (remote-exec):   Host: 62.84.125.140
yandex_compute_instance.vm4ans (remote-exec):   User: ubuntu
yandex_compute_instance.vm4ans (remote-exec):   Password: false
yandex_compute_instance.vm4ans (remote-exec):   Private key: true
yandex_compute_instance.vm4ans (remote-exec):   Certificate: false
yandex_compute_instance.vm4ans (remote-exec):   SSH Agent: false
yandex_compute_instance.vm4ans (remote-exec):   Checking Host Key: false
yandex_compute_instance.vm4ans (remote-exec):   Target Platform: unix
yandex_compute_instance.vm4ans: Still creating... [1m0s elapsed]
yandex_compute_instance.vm4ans: Still creating... [1m10s elapsed]
yandex_compute_instance.vm4ans (remote-exec): Connecting to remote host via SSH...
yandex_compute_instance.vm4ans (remote-exec):   Host: 62.84.125.140
yandex_compute_instance.vm4ans (remote-exec):   User: ubuntu
yandex_compute_instance.vm4ans (remote-exec):   Password: false
yandex_compute_instance.vm4ans (remote-exec):   Private key: true
yandex_compute_instance.vm4ans (remote-exec):   Certificate: false
yandex_compute_instance.vm4ans (remote-exec):   SSH Agent: false
yandex_compute_instance.vm4ans (remote-exec):   Checking Host Key: false
yandex_compute_instance.vm4ans (remote-exec):   Target Platform: unix
yandex_compute_instance.vm4ans (remote-exec): Connecting to remote host via SSH...
yandex_compute_instance.vm4ans (remote-exec):   Host: 62.84.125.140
yandex_compute_instance.vm4ans (remote-exec):   User: ubuntu
yandex_compute_instance.vm4ans (remote-exec):   Password: false
yandex_compute_instance.vm4ans (remote-exec):   Private key: true
yandex_compute_instance.vm4ans (remote-exec):   Certificate: false
yandex_compute_instance.vm4ans (remote-exec):   SSH Agent: false
yandex_compute_instance.vm4ans (remote-exec):   Checking Host Key: false
yandex_compute_instance.vm4ans (remote-exec):   Target Platform: unix
yandex_compute_instance.vm4ans: Still creating... [1m20s elapsed]
yandex_compute_instance.vm4ans (remote-exec): Connecting to remote host via SSH...
yandex_compute_instance.vm4ans (remote-exec):   Host: 62.84.125.140
yandex_compute_instance.vm4ans (remote-exec):   User: ubuntu
yandex_compute_instance.vm4ans (remote-exec):   Password: false
yandex_compute_instance.vm4ans (remote-exec):   Private key: true
yandex_compute_instance.vm4ans (remote-exec):   Certificate: false
yandex_compute_instance.vm4ans (remote-exec):   SSH Agent: false
yandex_compute_instance.vm4ans (remote-exec):   Checking Host Key: false
yandex_compute_instance.vm4ans (remote-exec):   Target Platform: unix
yandex_compute_instance.vm4ans: Still creating... [1m30s elapsed]
yandex_compute_instance.vm4ans (remote-exec): Connecting to remote host via SSH...
yandex_compute_instance.vm4ans (remote-exec):   Host: 62.84.125.140
yandex_compute_instance.vm4ans (remote-exec):   User: ubuntu
yandex_compute_instance.vm4ans (remote-exec):   Password: false
yandex_compute_instance.vm4ans (remote-exec):   Private key: true
yandex_compute_instance.vm4ans (remote-exec):   Certificate: false
yandex_compute_instance.vm4ans (remote-exec):   SSH Agent: false
yandex_compute_instance.vm4ans (remote-exec):   Checking Host Key: false
yandex_compute_instance.vm4ans (remote-exec):   Target Platform: unix
yandex_compute_instance.vm4ans (remote-exec): Connected!
yandex_compute_instance.vm4ans: Still creating... [1m40s elapsed]
yandex_compute_instance.vm4ans: Provisioning with 'local-exec'...
yandex_compute_instance.vm4ans (local-exec): Executing: ["/bin/sh" "-c" "export ANSIBLE_HOST_KEY_CHECKING=False\nansible -u ubuntu -i '62.84.125.140,' --private-key ~/.ssh/id_rsa -m ping all\n"]
yandex_compute_instance.vm4ans (local-exec): 62.84.125.140 | SUCCESS => {
yandex_compute_instance.vm4ans (local-exec):     "ansible_facts": {
yandex_compute_instance.vm4ans (local-exec):         "discovered_interpreter_python": "/usr/bin/python3"
yandex_compute_instance.vm4ans (local-exec):     },
yandex_compute_instance.vm4ans (local-exec):     "changed": false,
yandex_compute_instance.vm4ans (local-exec):     "ping": "pong"
yandex_compute_instance.vm4ans (local-exec): }
yandex_compute_instance.vm4ans: Creation complete after 1m43s [id=fhmr618dric82934ukq2]

Apply complete! Resources: 3 added, 0 changed, 0 destroyed.

Outputs:

ansible_inventory = <<EOT
[vms]
vm4ans ansible_host=62.84.125.140 ansible_user=ubuntu ansible_ssh_host_key_checking=False

EOT
aleksey@first:~/OtusTeam/IaC/les10/ans_in_tf$ tf output -raw ansible_inventory
[vms]
vm4ans ansible_host=62.84.125.140 ansible_user=ubuntu ansible_ssh_host_key_checking=False
aleksey@first:~/OtusTeam/IaC/les10/ans_in_tf$ ./tf_output_2_inv.sh 
aleksey@first:~/OtusTeam/IaC/les10/ans_in_tf$ cat inv
[vms]
vm4ans ansible_host=62.84.125.140 ansible_user=ubuntu ansible_ssh_host_key_checking=False
aleksey@first:~/OtusTeam/IaC/les10/ans_in_tf$ ansible -i inv -m ping all
vm4ans | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": false,
    "ping": "pong"
}

aleksey@first:~/OtusTeam/IaC/les10/ans_in_tf$ tf destroy
yandex_vpc_network.net4ans: Refreshing state... [id=enpldvsit81gudhimkmm]
yandex_vpc_subnet.sub4ans: Refreshing state... [id=e9b04lkhslb00c82v2r9]
yandex_compute_instance.vm4ans: Refreshing state... [id=fhmr618dric82934ukq2]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  - destroy

Terraform will perform the following actions:

  # yandex_compute_instance.vm4ans will be destroyed
  - resource "yandex_compute_instance" "vm4ans" {
      - created_at                = "2024-07-30T05:41:10Z" -> null
      - folder_id                 = "b1gmesrdjgklgkvcp704" -> null
      - fqdn                      = "fhmr618dric82934ukq2.auto.internal" -> null
      - id                        = "fhmr618dric82934ukq2" -> null
      - labels                    = {} -> null
      - metadata                  = {
          - "ssh-keys" = (sensitive value)
        } -> null
      - name                      = "vm4ans" -> null
      - network_acceleration_type = "standard" -> null
      - platform_id               = "standard-v1" -> null
      - status                    = "running" -> null
      - zone                      = "ru-central1-a" -> null
        # (5 unchanged attributes hidden)

      - boot_disk {
          - auto_delete = true -> null
          - device_name = "fhm7obnrjn8skaqhsv1r" -> null
          - disk_id     = "fhm7obnrjn8skaqhsv1r" -> null
          - mode        = "READ_WRITE" -> null

          - initialize_params {
              - block_size  = 4096 -> null
              - image_id    = "fd8pecdhv50nec1qf9im" -> null
                name        = null
              - size        = 8 -> null
              - type        = "network-hdd" -> null
                # (2 unchanged attributes hidden)
            }
        }

      - metadata_options {
          - aws_v1_http_endpoint = 1 -> null
          - aws_v1_http_token    = 2 -> null
          - gce_http_endpoint    = 1 -> null
          - gce_http_token       = 1 -> null
        }

      - network_interface {
          - index              = 0 -> null
          - ip_address         = "10.2.0.34" -> null
          - ipv4               = true -> null
          - ipv6               = false -> null
          - mac_address        = "d0:0d:1b:30:50:dd" -> null
          - nat                = true -> null
          - nat_ip_address     = "62.84.125.140" -> null
          - nat_ip_version     = "IPV4" -> null
          - security_group_ids = [] -> null
          - subnet_id          = "e9b04lkhslb00c82v2r9" -> null
            # (1 unchanged attribute hidden)
        }

      - placement_policy {
          - host_affinity_rules       = [] -> null
          - placement_group_partition = 0 -> null
            # (1 unchanged attribute hidden)
        }

      - resources {
          - core_fraction = 100 -> null
          - cores         = 2 -> null
          - gpus          = 0 -> null
          - memory        = 2 -> null
        }

      - scheduling_policy {
          - preemptible = false -> null
        }
    }

  # yandex_vpc_network.net4ans will be destroyed
  - resource "yandex_vpc_network" "net4ans" {
      - created_at                = "2024-07-30T05:41:08Z" -> null
      - default_security_group_id = "enpbmm0tfc6h8toh8vjc" -> null
      - folder_id                 = "b1gmesrdjgklgkvcp704" -> null
      - id                        = "enpldvsit81gudhimkmm" -> null
      - labels                    = {} -> null
      - name                      = "net4ans" -> null
      - subnet_ids                = [
          - "e9b04lkhslb00c82v2r9",
        ] -> null
        # (1 unchanged attribute hidden)
    }

  # yandex_vpc_subnet.sub4ans will be destroyed
  - resource "yandex_vpc_subnet" "sub4ans" {
      - created_at     = "2024-07-30T05:41:10Z" -> null
      - folder_id      = "b1gmesrdjgklgkvcp704" -> null
      - id             = "e9b04lkhslb00c82v2r9" -> null
      - labels         = {} -> null
      - name           = "sub4ans" -> null
      - network_id     = "enpldvsit81gudhimkmm" -> null
      - v4_cidr_blocks = [
          - "10.2.0.0/16",
        ] -> null
      - v6_cidr_blocks = [] -> null
      - zone           = "ru-central1-a" -> null
        # (2 unchanged attributes hidden)
    }

Plan: 0 to add, 0 to change, 3 to destroy.

Changes to Outputs:
  - ansible_inventory = <<-EOT
        [vms]
        vm4ans ansible_host=62.84.125.140 ansible_user=ubuntu ansible_ssh_host_key_checking=False
    EOT -> null

Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only 'yes' will be accepted to confirm.

  Enter a value: yes

yandex_compute_instance.vm4ans: Destroying... [id=fhmr618dric82934ukq2]
yandex_compute_instance.vm4ans: Still destroying... [id=fhmr618dric82934ukq2, 10s elapsed]
yandex_compute_instance.vm4ans: Still destroying... [id=fhmr618dric82934ukq2, 20s elapsed]
yandex_compute_instance.vm4ans: Still destroying... [id=fhmr618dric82934ukq2, 30s elapsed]
yandex_compute_instance.vm4ans: Still destroying... [id=fhmr618dric82934ukq2, 40s elapsed]
yandex_compute_instance.vm4ans: Still destroying... [id=fhmr618dric82934ukq2, 50s elapsed]
yandex_compute_instance.vm4ans: Destruction complete after 51s
yandex_vpc_subnet.sub4ans: Destroying... [id=e9b04lkhslb00c82v2r9]
yandex_vpc_subnet.sub4ans: Destruction complete after 4s
yandex_vpc_network.net4ans: Destroying... [id=enpldvsit81gudhimkmm]
yandex_vpc_network.net4ans: Destruction complete after 1s

Destroy complete! Resources: 3 destroyed.
aleksey@first:~/OtusTeam/IaC/les10/ans_in_tf$ rm inv
