name: yc-object-hello
runtime: yaml
description: Minimal stable Object Storage example for Yandex Cloud

variables:
  prefix: ${config:prefix}

resources:

  sa:
    type: yandex:index/iamServiceAccount:IamServiceAccount
    properties:
      name: ${prefix}-sa

  saEditor:
    type: yandex:index/resourcemanagerFolderIamMember:ResourcemanagerFolderIamMember
    properties:
      folderId: ${yandex:folderId}
      role: storage.editor
      member: serviceAccount:${sa.id}

  saKey:
    type: yandex:index/iamServiceAccountStaticAccessKey:IamServiceAccountStaticAccessKey
    properties:
      serviceAccountId: ${sa.id}
      description: pulumi-static-key
    options:
      dependsOn:
        - ${saEditor}

  bucket:
    type: yandex:index/storageBucket:StorageBucket
    properties:
      bucket: ${prefix}-bucket
      accessKey: ${saKey.accessKey}
      secretKey: ${saKey.secretKey}
    options:
      dependsOn:
        - ${saEditor}

  helloObject:
    type: yandex:index/storageObject:StorageObject
    properties:
      bucket: ${bucket.bucket}
      key: hello.txt
      content: "Hello, World!"
      accessKey: ${saKey.accessKey}
      secretKey: ${saKey.secretKey}

outputs:
  bucketName: ${bucket.bucket}
  objectKey: ${helloObject.key}
  accessKey: ${saKey.accessKey}
  secretKey: ${saKey.secretKey}
