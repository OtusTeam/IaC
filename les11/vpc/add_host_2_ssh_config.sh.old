#!/bin/bash

# Проверка количества переданных параметров
if [ $# -ne 4 ]; then
    echo "Usage: $0 <host> <hostname> <user> <identity_file>"
    exit 1
fi

# Параметры для нового хоста
new_host="$1"
new_hostname="$2"
new_user="$3"
new_identity_file="$4"

# Функция для проверки наличия описания хоста в файле ~/.ssh/config
check_host_exist() {
    local host=$1
    local config_file="$HOME/.ssh/config"

    if [ -f "$config_file" ]; then
        grep -q "^Host $host$" "$config_file"
        return $?
    fi

    return 1
}

# Проверка наличия описания хоста
if check_host_exist "$new_host"; then
    # Описание хоста существует - заменяем его
    sed -i.bak "/^Host $new_host$/,/^$/c\
Host $new_host
    HostName $new_hostname
    User $new_user
    IdentityFile $new_identity_file
" "$HOME/.ssh/config"
    echo "Изменено описание хоста $new_host в файле ~/.ssh/config"
else
    # Описание хоста не существует - добавляем его в начало файла
    echo "Host $new_host
    HostName $new_hostname
    User $new_user
    IdentityFile $new_identity_file
$(cat "$HOME/.ssh/config")" > "$HOME/.ssh/config"
    echo "Добавлено описание хоста $new_host в файл ~/.ssh/config"
fi
