za@za-Vivobook-ASUSLaptop-M3504YA-M3504YA:~/Documents/IaC/2git/les04/explicit/static_website$ ./run.sh 
++ terraform validate
Success! The configuration is valid.

++ read -p 'Press enter to continue...'
Press enter to continue...
++ terraform graph
++ cat graph.txt
digraph G {
  rankdir = "RL";
  node [shape = rect, fontname = "sans-serif"];
  "null_resource.curl" [label="null_resource.curl"];
  "yandex_iam_service_account.sa" [label="yandex_iam_service_account.sa"];
  "yandex_iam_service_account_static_access_key.sa_static_key" [label="yandex_iam_service_account_static_access_key.sa_static_key"];
  "yandex_resourcemanager_folder_iam_member.sa_editor" [label="yandex_resourcemanager_folder_iam_member.sa_editor"];
  "yandex_storage_bucket.website" [label="yandex_storage_bucket.website"];
  "yandex_storage_bucket_grant.public_read" [label="yandex_storage_bucket_grant.public_read"];
  "yandex_storage_bucket_iam_binding.storage_admin" [label="yandex_storage_bucket_iam_binding.storage_admin"];
  "yandex_storage_object.error-html" [label="yandex_storage_object.error-html"];
  "yandex_storage_object.index-html" [label="yandex_storage_object.index-html"];
  "null_resource.curl" -> "yandex_storage_bucket_grant.public_read";
  "yandex_iam_service_account_static_access_key.sa_static_key" -> "yandex_iam_service_account.sa";
  "yandex_resourcemanager_folder_iam_member.sa_editor" -> "yandex_iam_service_account.sa";
  "yandex_storage_bucket.website" -> "yandex_iam_service_account_static_access_key.sa_static_key";
  "yandex_storage_bucket_grant.public_read" -> "yandex_storage_bucket_iam_binding.storage_admin";
  "yandex_storage_bucket_iam_binding.storage_admin" -> "yandex_storage_bucket.website";
  "yandex_storage_object.error-html" -> "yandex_storage_bucket.website";
  "yandex_storage_object.index-html" -> "yandex_storage_bucket.website";
}
++ read -p 'Press enter to continue...'
Press enter to continue...
++ cat graph.txt
++ dot -Tsvg
++ read -p 'Press enter to continue...'
Press enter to continue...
++ xdg-open graph.svg
++ read -p 'Press enter to continue...'
Press enter to continue...
++ terraform apply

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # null_resource.curl will be created
  + resource "null_resource" "curl" {
      + id = (known after apply)
    }

  # yandex_iam_service_account.sa will be created
  + resource "yandex_iam_service_account" "sa" {
      + created_at         = (known after apply)
      + description        = (known after apply)
      + folder_id          = (known after apply)
      + id                 = (known after apply)
      + name               = "les04-explicit-static-sa"
      + service_account_id = (known after apply)
    }

  # yandex_iam_service_account_static_access_key.sa_static_key will be created
  + resource "yandex_iam_service_account_static_access_key" "sa_static_key" {
      + access_key                   = (known after apply)
      + created_at                   = (known after apply)
      + description                  = "static access key for object storage"
      + encrypted_secret_key         = (known after apply)
      + id                           = (known after apply)
      + key_fingerprint              = (known after apply)
      + output_to_lockbox_version_id = (known after apply)
      + secret_key                   = (sensitive value)
      + service_account_id           = (known after apply)
    }

  # yandex_resourcemanager_folder_iam_member.sa_editor will be created
  + resource "yandex_resourcemanager_folder_iam_member" "sa_editor" {
      + folder_id = "b1gmesrdjgklgkvcp704"
      + member    = (known after apply)
      + role      = "storage.editor"
    }

  # yandex_storage_bucket.website will be created
  + resource "yandex_storage_bucket" "website" {
      + access_key            = (known after apply)
      + acl                   = (known after apply)
      + bucket                = "les04-explicit-static-web"
      + bucket_domain_name    = (known after apply)
      + default_storage_class = (known after apply)
      + folder_id             = (known after apply)
      + force_destroy         = false
      + id                    = (known after apply)
      + max_size              = 1073741824
      + policy                = (known after apply)
      + secret_key            = (sensitive value)
      + website_domain        = (known after apply)
      + website_endpoint      = (known after apply)

      + anonymous_access_flags (known after apply)

      + grant (known after apply)

      + versioning (known after apply)

      + website {
          + error_document = "error.html"
          + index_document = "index.html"
        }
    }

  # yandex_storage_bucket_grant.public_read will be created
  + resource "yandex_storage_bucket_grant" "public_read" {
      + access_key = (known after apply)
      + acl        = "public-read"
      + bucket     = "les04-explicit-static-web"
      + secret_key = (sensitive value)
    }

  # yandex_storage_bucket_iam_binding.storage_admin will be created
  + resource "yandex_storage_bucket_iam_binding" "storage_admin" {
      + bucket  = "les04-explicit-static-web"
      + members = [
          + (known after apply),
        ]
      + role    = "storage.admin"
    }

  # yandex_storage_object.error-html will be created
  + resource "yandex_storage_object" "error-html" {
      + access_key   = (known after apply)
      + acl          = "private"
      + bucket       = (known after apply)
      + content_type = (known after apply)
      + id           = (known after apply)
      + key          = "error.html"
      + secret_key   = (sensitive value)
      + source       = "error.html"
    }

  # yandex_storage_object.index-html will be created
  + resource "yandex_storage_object" "index-html" {
      + access_key   = (known after apply)
      + acl          = "private"
      + bucket       = (known after apply)
      + content_type = (known after apply)
      + id           = (known after apply)
      + key          = "index.html"
      + secret_key   = (sensitive value)
      + source       = "index.html"
    }

Plan: 9 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + website_endpoint = (known after apply)

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

yandex_iam_service_account.sa: Creating...
yandex_iam_service_account.sa: Creation complete after 3s [id=ajet9sldk462l8ts79gc]
yandex_iam_service_account_static_access_key.sa_static_key: Creating...
yandex_resourcemanager_folder_iam_member.sa_editor: Creating...
yandex_iam_service_account_static_access_key.sa_static_key: Creation complete after 2s [id=aje5u52gqnojs5anucgq]
yandex_storage_bucket.website: Creating...
yandex_resourcemanager_folder_iam_member.sa_editor: Creation complete after 3s
yandex_storage_bucket.website: Still creating... [00m10s elapsed]
yandex_storage_bucket.website: Still creating... [00m20s elapsed]
yandex_storage_bucket.website: Creation complete after 24s [id=les04-explicit-static-web]
yandex_storage_object.index-html: Creating...
yandex_storage_object.error-html: Creating...
yandex_storage_bucket_iam_binding.storage_admin: Creating...
yandex_storage_object.error-html: Creation complete after 1s [id=error.html]
yandex_storage_object.index-html: Creation complete after 1s [id=index.html]
yandex_storage_bucket_iam_binding.storage_admin: Creation complete after 5s
yandex_storage_bucket_grant.public_read: Creating...
yandex_storage_bucket_grant.public_read: Creation complete after 2s
null_resource.curl: Creating...
null_resource.curl: Provisioning with 'local-exec'...
null_resource.curl (local-exec): Executing: ["/bin/sh" "-c" "curl https://storage.yandexcloud.net/les04-explicit-static-web/index.html"]
null_resource.curl (local-exec):   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
null_resource.curl (local-exec):                                  Dload  Upload   Total   Spent    Left  Speed
null_resource.curl (local-exec):   0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
null_resource.curl (local-exec):   0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
null_resource.curl (local-exec): 100   127  100   127    0     0    403      0 --:--:-- --:--:-- --:--:--   403
null_resource.curl (local-exec): <!doctype html>
null_resource.curl (local-exec): <html>
null_resource.curl (local-exec):   <head>
null_resource.curl (local-exec):     <title>Hello, world!</title>
null_resource.curl (local-exec):   </head>
null_resource.curl (local-exec):   <body>
null_resource.curl (local-exec):     <p>Hello, world!</p>
null_resource.curl (local-exec):   </body>
null_resource.curl (local-exec): </html>
null_resource.curl: Provisioning with 'local-exec'...
null_resource.curl (local-exec): Executing: ["/bin/sh" "-c" "curl https://website.yandexcloud.net/les04-explicit-static-web/"]
null_resource.curl (local-exec):   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
null_resource.curl (local-exec):                                  Dload  Upload   Total   Spent    Left  Speed
null_resource.curl (local-exec):   0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
null_resource.curl (local-exec): 100   127  100   127    0     0    426      0 --:--:-- --:--:-- --:--:--   427
null_resource.curl (local-exec): <!doctype html>
null_resource.curl (local-exec): <html>
null_resource.curl (local-exec):   <head>
null_resource.curl (local-exec):     <title>Hello, world!</title>
null_resource.curl (local-exec):   </head>
null_resource.curl (local-exec):   <body>
null_resource.curl (local-exec):     <p>Hello, world!</p>
null_resource.curl (local-exec):   </body>
null_resource.curl (local-exec): </html>
null_resource.curl: Creation complete after 0s [id=4436564065457857076]

Apply complete! Resources: 9 added, 0 changed, 0 destroyed.

Outputs:

website_endpoint = "les04-explicit-static-web.website.yandexcloud.net"
+++ terraform output -raw website_endpoint
++ curl https://les04-explicit-static-web.website.yandexcloud.net
<!doctype html>
<html>
  <head>
    <title>Hello, world!</title>
  </head>
  <body>
    <p>Hello, world!</p>
  </body>
</html>
++ read -p 'Press enter to destroy infra...'
Press enter to destroy infra...
++ terraform destroy
yandex_iam_service_account.sa: Refreshing state... [id=ajet9sldk462l8ts79gc]
yandex_resourcemanager_folder_iam_member.sa_editor: Refreshing state...
yandex_iam_service_account_static_access_key.sa_static_key: Refreshing state... [id=aje5u52gqnojs5anucgq]
yandex_storage_bucket.website: Refreshing state... [id=les04-explicit-static-web]
yandex_storage_bucket_iam_binding.storage_admin: Refreshing state...
yandex_storage_object.index-html: Refreshing state... [id=index.html]
yandex_storage_object.error-html: Refreshing state... [id=error.html]
yandex_storage_bucket_grant.public_read: Refreshing state...
null_resource.curl: Refreshing state... [id=4436564065457857076]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  - destroy

Terraform will perform the following actions:

  # null_resource.curl will be destroyed
  - resource "null_resource" "curl" {
      - id = "4436564065457857076" -> null
    }

  # yandex_iam_service_account.sa will be destroyed
  - resource "yandex_iam_service_account" "sa" {
      - created_at         = "2025-12-01T05:07:12Z" -> null
      - folder_id          = "b1gmesrdjgklgkvcp704" -> null
      - id                 = "ajet9sldk462l8ts79gc" -> null
      - name               = "les04-explicit-static-sa" -> null
      - service_account_id = "ajet9sldk462l8ts79gc" -> null
        # (1 unchanged attribute hidden)
    }

  # yandex_iam_service_account_static_access_key.sa_static_key will be destroyed
  - resource "yandex_iam_service_account_static_access_key" "sa_static_key" {
      - access_key         = "YCAJESf7UymYXoOWb-k5i8bYe" -> null
      - created_at         = "2025-12-01T05:07:15Z" -> null
      - description        = "static access key for object storage" -> null
      - id                 = "aje5u52gqnojs5anucgq" -> null
      - secret_key         = (sensitive value) -> null
      - service_account_id = "ajet9sldk462l8ts79gc" -> null
    }

  # yandex_resourcemanager_folder_iam_member.sa_editor will be destroyed
  - resource "yandex_resourcemanager_folder_iam_member" "sa_editor" {
      - folder_id = "b1gmesrdjgklgkvcp704" -> null
      - member    = "serviceAccount:ajet9sldk462l8ts79gc" -> null
      - role      = "storage.editor" -> null
    }

  # yandex_storage_bucket.website will be destroyed
  - resource "yandex_storage_bucket" "website" {
      - access_key            = "YCAJESf7UymYXoOWb-k5i8bYe" -> null
      - bucket                = "les04-explicit-static-web" -> null
      - bucket_domain_name    = "les04-explicit-static-web.storage.yandexcloud.net" -> null
      - default_storage_class = "STANDARD" -> null
      - folder_id             = "b1gmesrdjgklgkvcp704" -> null
      - force_destroy         = false -> null
      - id                    = "les04-explicit-static-web" -> null
      - max_size              = 1073741824 -> null
      - secret_key            = (sensitive value) -> null
      - tags                  = {} -> null
      - website_domain        = "website.yandexcloud.net" -> null
      - website_endpoint      = "les04-explicit-static-web.website.yandexcloud.net" -> null
        # (1 unchanged attribute hidden)

      - anonymous_access_flags {
          - config_read = true -> null
          - list        = true -> null
          - read        = true -> null
        }

      - grant {
            id          = null
          - permissions = [
              - "READ",
            ] -> null
          - type        = "Group" -> null
          - uri         = "http://acs.amazonaws.com/groups/global/AllUsers" -> null
        }

      - versioning {
          - enabled = false -> null
        }

      - website {
          - error_document           = "error.html" -> null
          - index_document           = "index.html" -> null
            # (2 unchanged attributes hidden)
        }
    }

  # yandex_storage_bucket_grant.public_read will be destroyed
  - resource "yandex_storage_bucket_grant" "public_read" {
      - access_key = "YCAJESf7UymYXoOWb-k5i8bYe" -> null
      - acl        = "public-read" -> null
      - bucket     = "les04-explicit-static-web" -> null
      - secret_key = (sensitive value) -> null
    }

  # yandex_storage_bucket_iam_binding.storage_admin will be destroyed
  - resource "yandex_storage_bucket_iam_binding" "storage_admin" {
      - bucket  = "les04-explicit-static-web" -> null
      - members = [
          - "serviceAccount:ajet9sldk462l8ts79gc",
        ] -> null
      - role    = "storage.admin" -> null
    }

  # yandex_storage_object.error-html will be destroyed
  - resource "yandex_storage_object" "error-html" {
      - access_key   = "YCAJESf7UymYXoOWb-k5i8bYe" -> null
      - acl          = "private" -> null
      - bucket       = "les04-explicit-static-web" -> null
      - content_type = "application/octet-stream" -> null
      - id           = "error.html" -> null
      - key          = "error.html" -> null
      - secret_key   = (sensitive value) -> null
      - source       = "error.html" -> null
      - tags         = {} -> null
    }

  # yandex_storage_object.index-html will be destroyed
  - resource "yandex_storage_object" "index-html" {
      - access_key   = "YCAJESf7UymYXoOWb-k5i8bYe" -> null
      - acl          = "private" -> null
      - bucket       = "les04-explicit-static-web" -> null
      - content_type = "application/octet-stream" -> null
      - id           = "index.html" -> null
      - key          = "index.html" -> null
      - secret_key   = (sensitive value) -> null
      - source       = "index.html" -> null
      - tags         = {} -> null
    }

Plan: 0 to add, 0 to change, 9 to destroy.

Changes to Outputs:
  - website_endpoint = "les04-explicit-static-web.website.yandexcloud.net" -> null

Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only 'yes' will be accepted to confirm.

  Enter a value: yes

null_resource.curl: Destroying... [id=4436564065457857076]
null_resource.curl: Destruction complete after 0s
yandex_resourcemanager_folder_iam_member.sa_editor: Destroying...
yandex_storage_bucket_grant.public_read: Destroying...
yandex_storage_object.error-html: Destroying... [id=error.html]
yandex_storage_object.index-html: Destroying... [id=index.html]
yandex_storage_object.index-html: Destruction complete after 0s
yandex_storage_object.error-html: Destruction complete after 0s
yandex_storage_bucket_grant.public_read: Destruction complete after 2s
yandex_storage_bucket_iam_binding.storage_admin: Destroying...
yandex_resourcemanager_folder_iam_member.sa_editor: Destruction complete after 3s
yandex_storage_bucket_iam_binding.storage_admin: Destruction complete after 3s
yandex_storage_bucket.website: Destroying... [id=les04-explicit-static-web]
╷
│ Error: error deleting Storage Bucket (les04-explicit-static-web): AccessDenied: Access Denied
│ 	status code: 403, request id: 68069e1ba22b3f8c, host id: 
│ 
│ 
╵
++ yc storage buckets delete les04-explicit-static-web --folder-id b1gmesrdjgklgkvcp704
done (10s)
++ yc iam service-account delete les04-explicit-static-sa --folder-id b1gmesrdjgklgkvcp704
done (3s)
++ echo 'If not deleted use the web console to delete bucket "les04-static-sa" and sa "les04-static-sa"!'
If not deleted use the web console to delete bucket "les04-static-sa" and sa "les04-static-sa"!
++ read -p 'Press enter to continue to clear current terraform.tfstate...'
Press enter to continue to clear current terraform.tfstate...
+++ date +%s
++ cp terraform.tfstate terraform.tfstate.1764565722
++ cp tfs.empty terraform.tfstate
++ set +x
