za@za-Vivobook-ASUSLaptop-M3504YA-M3504YA:~/Documents/IaC/2git/les04/explicit/static_website$ ./run.sh 
++ terraform apply

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create

Terraform will perform the following actions:

  # null_resource.curl will be created
  + resource "null_resource" "curl" {
      + id = (known after apply)
    }

  # yandex_iam_service_account.sa will be created
  + resource "yandex_iam_service_account" "sa" {
      + created_at         = (known after apply)
      + description        = (known after apply)
      + folder_id          = (known after apply)
      + id                 = (known after apply)
      + name               = "les04-static-sa"
      + service_account_id = (known after apply)
    }

  # yandex_iam_service_account_static_access_key.sa-static-key will be created
  + resource "yandex_iam_service_account_static_access_key" "sa-static-key" {
      + access_key                   = (known after apply)
      + created_at                   = (known after apply)
      + description                  = "static access key for object storage"
      + encrypted_secret_key         = (known after apply)
      + id                           = (known after apply)
      + key_fingerprint              = (known after apply)
      + output_to_lockbox_version_id = (known after apply)
      + secret_key                   = (sensitive value)
      + service_account_id           = (known after apply)
    }

  # yandex_resourcemanager_folder_iam_member.sa-editor will be created
  + resource "yandex_resourcemanager_folder_iam_member" "sa-editor" {
      + folder_id = "b1gmesrdjgklgkvcp704"
      + member    = (known after apply)
      + role      = "storage.editor"
    }

  # yandex_storage_bucket.default_access will be created
  + resource "yandex_storage_bucket" "default_access" {
      + access_key            = (known after apply)
      + acl                   = (known after apply)
      + bucket                = "les04-static-web"
      + bucket_domain_name    = (known after apply)
      + default_storage_class = (known after apply)
      + folder_id             = (known after apply)
      + force_destroy         = false
      + id                    = (known after apply)
      + max_size              = 1073741824
      + policy                = (known after apply)
      + secret_key            = (sensitive value)
      + website_domain        = (known after apply)
      + website_endpoint      = (known after apply)

      + anonymous_access_flags (known after apply)

      + grant (known after apply)

      + versioning (known after apply)

      + website {
          + error_document = "error.html"
          + index_document = "index.html"
        }
    }

  # yandex_storage_bucket_grant.public_read will be created
  + resource "yandex_storage_bucket_grant" "public_read" {
      + access_key = (known after apply)
      + acl        = "public-read"
      + bucket     = "les04-static-web"
      + secret_key = (sensitive value)
    }

  # yandex_storage_bucket_iam_binding.storage_admin will be created
  + resource "yandex_storage_bucket_iam_binding" "storage_admin" {
      + bucket  = "les04-static-web"
      + members = [
          + (known after apply),
        ]
      + role    = "storage.admin"
    }

  # yandex_storage_object.error-html will be created
  + resource "yandex_storage_object" "error-html" {
      + access_key   = (known after apply)
      + acl          = "private"
      + bucket       = (known after apply)
      + content_type = (known after apply)
      + id           = (known after apply)
      + key          = "error.html"
      + secret_key   = (sensitive value)
      + source       = "error.html"
    }

  # yandex_storage_object.index-html will be created
  + resource "yandex_storage_object" "index-html" {
      + access_key   = (known after apply)
      + acl          = "private"
      + bucket       = (known after apply)
      + content_type = (known after apply)
      + id           = (known after apply)
      + key          = "index.html"
      + secret_key   = (sensitive value)
      + source       = "index.html"
    }

Plan: 9 to add, 0 to change, 0 to destroy.

Changes to Outputs:
  + website_endpoint = (known after apply)

Do you want to perform these actions?
  Terraform will perform the actions described above.
  Only 'yes' will be accepted to approve.

  Enter a value: yes

yandex_iam_service_account.sa: Creating...
yandex_iam_service_account.sa: Creation complete after 2s [id=aje14f18ojb35o80rlml]
yandex_iam_service_account_static_access_key.sa-static-key: Creating...
yandex_resourcemanager_folder_iam_member.sa-editor: Creating...
yandex_iam_service_account_static_access_key.sa-static-key: Creation complete after 2s [id=ajevflmkgrl91t671du7]
yandex_storage_bucket.default_access: Creating...
yandex_resourcemanager_folder_iam_member.sa-editor: Creation complete after 4s
yandex_storage_bucket.default_access: Still creating... [00m10s elapsed]
yandex_storage_bucket.default_access: Still creating... [00m20s elapsed]
yandex_storage_bucket.default_access: Creation complete after 25s [id=les04-static-web]
yandex_storage_object.error-html: Creating...
yandex_storage_object.index-html: Creating...
yandex_storage_bucket_iam_binding.storage_admin: Creating...
yandex_storage_object.index-html: Creation complete after 0s [id=index.html]
yandex_storage_object.error-html: Creation complete after 0s [id=error.html]
yandex_storage_bucket_iam_binding.storage_admin: Creation complete after 3s
yandex_storage_bucket_grant.public_read: Creating...
yandex_storage_bucket_grant.public_read: Creation complete after 2s
null_resource.curl: Creating...
null_resource.curl: Provisioning with 'local-exec'...
null_resource.curl (local-exec): Executing: ["/bin/sh" "-c" "curl https://storage.yandexcloud.net/les04-static-web/index.html"]
null_resource.curl (local-exec):   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
null_resource.curl (local-exec):                                  Dload  Upload   Total   Spent    Left  Speed
null_resource.curl (local-exec):   0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
null_resource.curl (local-exec): 100   127  100   127    0     0    446      0 --:--:-- --:--:-- --:--:--   447
null_resource.curl (local-exec): <!doctype html>
null_resource.curl (local-exec): <html>
null_resource.curl (local-exec):   <head>
null_resource.curl (local-exec):     <title>Hello, world!</title>
null_resource.curl (local-exec):   </head>
null_resource.curl (local-exec):   <body>
null_resource.curl (local-exec):     <p>Hello, world!</p>
null_resource.curl (local-exec):   </body>
null_resource.curl (local-exec): </html>
null_resource.curl: Provisioning with 'local-exec'...
null_resource.curl (local-exec): Executing: ["/bin/sh" "-c" "curl https://website.yandexcloud.net/les04-static-web/"]
null_resource.curl (local-exec):   % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
null_resource.curl (local-exec):                                  Dload  Upload   Total   Spent    Left  Speed
null_resource.curl (local-exec):   0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
null_resource.curl (local-exec):   0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0
null_resource.curl (local-exec): 100   127  100   127    0     0    318      0 --:--:-- --:--:-- --:--:--   318
null_resource.curl (local-exec): <!doctype html>
null_resource.curl (local-exec): <html>
null_resource.curl (local-exec):   <head>
null_resource.curl (local-exec):     <title>Hello, world!</title>
null_resource.curl (local-exec):   </head>
null_resource.curl (local-exec):   <body>
null_resource.curl (local-exec):     <p>Hello, world!</p>
null_resource.curl (local-exec):   </body>
null_resource.curl (local-exec): </html>
null_resource.curl: Creation complete after 1s [id=8324497394733399663]

Apply complete! Resources: 9 added, 0 changed, 0 destroyed.

Outputs:

website_endpoint = "les04-static-web.website.yandexcloud.net"
+++ terraform output -raw website_endpoint
++ curl https://les04-static-web.website.yandexcloud.net
<!doctype html>
<html>
  <head>
    <title>Hello, world!</title>
  </head>
  <body>
    <p>Hello, world!</p>
  </body>
</html>
++ terraform destroy
yandex_iam_service_account.sa: Refreshing state... [id=aje14f18ojb35o80rlml]
yandex_resourcemanager_folder_iam_member.sa-editor: Refreshing state...
yandex_iam_service_account_static_access_key.sa-static-key: Refreshing state... [id=ajevflmkgrl91t671du7]
yandex_storage_bucket.default_access: Refreshing state... [id=les04-static-web]
yandex_storage_bucket_iam_binding.storage_admin: Refreshing state...
yandex_storage_object.error-html: Refreshing state... [id=error.html]
yandex_storage_object.index-html: Refreshing state... [id=index.html]
yandex_storage_bucket_grant.public_read: Refreshing state...
null_resource.curl: Refreshing state... [id=8324497394733399663]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  - destroy

Terraform will perform the following actions:

  # null_resource.curl will be destroyed
  - resource "null_resource" "curl" {
      - id = "8324497394733399663" -> null
    }

  # yandex_iam_service_account.sa will be destroyed
  - resource "yandex_iam_service_account" "sa" {
      - created_at         = "2025-11-27T11:05:59Z" -> null
      - folder_id          = "b1gmesrdjgklgkvcp704" -> null
      - id                 = "aje14f18ojb35o80rlml" -> null
      - name               = "les04-static-sa" -> null
      - service_account_id = "aje14f18ojb35o80rlml" -> null
        # (1 unchanged attribute hidden)
    }

  # yandex_iam_service_account_static_access_key.sa-static-key will be destroyed
  - resource "yandex_iam_service_account_static_access_key" "sa-static-key" {
      - access_key         = "YCAJENX1VFkD3wwONyLSGAkjS" -> null
      - created_at         = "2025-11-27T11:06:01Z" -> null
      - description        = "static access key for object storage" -> null
      - id                 = "ajevflmkgrl91t671du7" -> null
      - secret_key         = (sensitive value) -> null
      - service_account_id = "aje14f18ojb35o80rlml" -> null
    }

  # yandex_resourcemanager_folder_iam_member.sa-editor will be destroyed
  - resource "yandex_resourcemanager_folder_iam_member" "sa-editor" {
      - folder_id = "b1gmesrdjgklgkvcp704" -> null
      - member    = "serviceAccount:aje14f18ojb35o80rlml" -> null
      - role      = "storage.editor" -> null
    }

  # yandex_storage_bucket.default_access will be destroyed
  - resource "yandex_storage_bucket" "default_access" {
      - access_key            = "YCAJENX1VFkD3wwONyLSGAkjS" -> null
      - bucket                = "les04-static-web" -> null
      - bucket_domain_name    = "les04-static-web.storage.yandexcloud.net" -> null
      - default_storage_class = "STANDARD" -> null
      - folder_id             = "b1gmesrdjgklgkvcp704" -> null
      - force_destroy         = false -> null
      - id                    = "les04-static-web" -> null
      - max_size              = 1073741824 -> null
      - secret_key            = (sensitive value) -> null
      - tags                  = {} -> null
      - website_domain        = "website.yandexcloud.net" -> null
      - website_endpoint      = "les04-static-web.website.yandexcloud.net" -> null
        # (1 unchanged attribute hidden)

      - anonymous_access_flags {
          - config_read = true -> null
          - list        = true -> null
          - read        = true -> null
        }

      - grant {
            id          = null
          - permissions = [
              - "READ",
            ] -> null
          - type        = "Group" -> null
          - uri         = "http://acs.amazonaws.com/groups/global/AllUsers" -> null
        }

      - versioning {
          - enabled = false -> null
        }

      - website {
          - error_document           = "error.html" -> null
          - index_document           = "index.html" -> null
            # (2 unchanged attributes hidden)
        }
    }

  # yandex_storage_bucket_grant.public_read will be destroyed
  - resource "yandex_storage_bucket_grant" "public_read" {
      - access_key = "YCAJENX1VFkD3wwONyLSGAkjS" -> null
      - acl        = "public-read" -> null
      - bucket     = "les04-static-web" -> null
      - secret_key = (sensitive value) -> null
    }

  # yandex_storage_bucket_iam_binding.storage_admin will be destroyed
  - resource "yandex_storage_bucket_iam_binding" "storage_admin" {
      - bucket  = "les04-static-web" -> null
      - members = [
          - "serviceAccount:aje14f18ojb35o80rlml",
        ] -> null
      - role    = "storage.admin" -> null
    }

  # yandex_storage_object.error-html will be destroyed
  - resource "yandex_storage_object" "error-html" {
      - access_key   = "YCAJENX1VFkD3wwONyLSGAkjS" -> null
      - acl          = "private" -> null
      - bucket       = "les04-static-web" -> null
      - content_type = "application/octet-stream" -> null
      - id           = "error.html" -> null
      - key          = "error.html" -> null
      - secret_key   = (sensitive value) -> null
      - source       = "error.html" -> null
      - tags         = {} -> null
    }

  # yandex_storage_object.index-html will be destroyed
  - resource "yandex_storage_object" "index-html" {
      - access_key   = "YCAJENX1VFkD3wwONyLSGAkjS" -> null
      - acl          = "private" -> null
      - bucket       = "les04-static-web" -> null
      - content_type = "application/octet-stream" -> null
      - id           = "index.html" -> null
      - key          = "index.html" -> null
      - secret_key   = (sensitive value) -> null
      - source       = "index.html" -> null
      - tags         = {} -> null
    }

Plan: 0 to add, 0 to change, 9 to destroy.

Changes to Outputs:
  - website_endpoint = "les04-static-web.website.yandexcloud.net" -> null

Do you really want to destroy all resources?
  Terraform will destroy all your managed infrastructure, as shown above.
  There is no undo. Only 'yes' will be accepted to confirm.

  Enter a value: yes

null_resource.curl: Destroying... [id=8324497394733399663]
null_resource.curl: Destruction complete after 0s
yandex_resourcemanager_folder_iam_member.sa-editor: Destroying...
yandex_storage_bucket_grant.public_read: Destroying...
yandex_storage_object.index-html: Destroying... [id=index.html]
yandex_storage_object.error-html: Destroying... [id=error.html]
yandex_storage_object.error-html: Destruction complete after 0s
yandex_storage_object.index-html: Destruction complete after 0s
yandex_storage_bucket_grant.public_read: Destruction complete after 2s
yandex_storage_bucket_iam_binding.storage_admin: Destroying...
yandex_resourcemanager_folder_iam_member.sa-editor: Destruction complete after 3s
yandex_storage_bucket_iam_binding.storage_admin: Destruction complete after 2s
yandex_storage_bucket.default_access: Destroying... [id=les04-static-web]
╷
│ Error: error deleting Storage Bucket (les04-static-web): AccessDenied: Access Denied
│ 	status code: 403, request id: 79179ff4591fa60f, host id: 
│ 
│ 
╵
++ yc storage buckets delete les04-static-web --folder-id b1gmesrdjgklgkvcp704
done (11s)
++ yc iam service-account delete les04-static-sa --folder-id b1gmesrdjgklgkvcp704
done (4s)
++ echo 'If not deleted use the web console to delete bucket "les04-static-sa" and sa "les04-static-sa"!'
If not deleted use the web console to delete bucket "les04-static-sa" and sa "les04-static-sa"!
++ read -p 'Press any key to clear current terraform.tfstate'
Press any key to clear current terraform.tfstate
+++ date +%s
++ cp terraform.tfstate terraform.tfstate.1764241642
++ cp tfs.empty terraform.tfstate
++ set +x
