aleksey@first:~/OtusTeam/IaC/les02/webserver$ packer build ws_hello.json.pkr.hcl 
yandex.autogenerated_1: output will be in this color.

==> yandex.autogenerated_1: Creating temporary RSA SSH key for instance...
==> yandex.autogenerated_1: Using as source image: fd8l04iucc4vsh00rkb1 (name: "ubuntu-22-04-lts-v20240701", family: "ubuntu-2204-lts")
==> yandex.autogenerated_1: Creating network...
==> yandex.autogenerated_1: Creating subnet in zone "ru-central1-a"...
==> yandex.autogenerated_1: Creating disk...
==> yandex.autogenerated_1: Creating instance...
==> yandex.autogenerated_1: Waiting for instance with id fhmclo02ov6q46fgglb4 to become active...
    yandex.autogenerated_1: Detected instance IP: 51.250.76.205
==> yandex.autogenerated_1: Using SSH communicator to connect: 51.250.76.205
==> yandex.autogenerated_1: Waiting for SSH to become available...
==> yandex.autogenerated_1: Connected to SSH!
==> yandex.autogenerated_1: Provisioning with shell script: /tmp/packer-shell4069186609
==> yandex.autogenerated_1:
==> yandex.autogenerated_1: WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
==> yandex.autogenerated_1:
    yandex.autogenerated_1: Hit:1 http://mirror.yandex.ru/ubuntu jammy InRelease
    yandex.autogenerated_1: Get:2 http://mirror.yandex.ru/ubuntu jammy-updates InRelease [128 kB]
    yandex.autogenerated_1: Hit:3 http://mirror.yandex.ru/ubuntu jammy-backports InRelease
    yandex.autogenerated_1: Get:4 http://security.ubuntu.com/ubuntu jammy-security InRelease [129 kB]
    yandex.autogenerated_1: Get:5 http://mirror.yandex.ru/ubuntu jammy-updates/main amd64 Packages [1,789 kB]
    yandex.autogenerated_1: Get:6 http://mirror.yandex.ru/ubuntu jammy-updates/main Translation-en [325 kB]
    yandex.autogenerated_1: Get:7 http://mirror.yandex.ru/ubuntu jammy-updates/restricted amd64 Packages [2,082 kB]
    yandex.autogenerated_1: Get:8 http://mirror.yandex.ru/ubuntu jammy-updates/restricted Translation-en [354 kB]
    yandex.autogenerated_1: Get:9 http://mirror.yandex.ru/ubuntu jammy-updates/universe amd64 Packages [1,095 kB]
    yandex.autogenerated_1: Get:10 http://mirror.yandex.ru/ubuntu jammy-updates/universe Translation-en [254 kB]
    yandex.autogenerated_1: Get:11 http://security.ubuntu.com/ubuntu jammy-security/main amd64 Packages [1,579 kB]
    yandex.autogenerated_1: Get:12 http://security.ubuntu.com/ubuntu jammy-security/main Translation-en [268 kB]
    yandex.autogenerated_1: Get:13 http://security.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [2,021 kB]
    yandex.autogenerated_1: Get:14 http://security.ubuntu.com/ubuntu jammy-security/restricted Translation-en [345 kB]
    yandex.autogenerated_1: Get:15 http://security.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [878 kB]
    yandex.autogenerated_1: Get:16 http://security.ubuntu.com/ubuntu jammy-security/universe Translation-en [171 kB]
    yandex.autogenerated_1: Fetched 11.4 MB in 2s (5,412 kB/s)
    yandex.autogenerated_1: Reading package lists...
    yandex.autogenerated_1: Building dependency tree...
    yandex.autogenerated_1: Reading state information...
    yandex.autogenerated_1: 10 packages can be upgraded. Run 'apt list --upgradable' to see them.
==> yandex.autogenerated_1:
==> yandex.autogenerated_1: WARNING: apt does not have a stable CLI interface. Use with caution in scripts.
==> yandex.autogenerated_1:
    yandex.autogenerated_1: Reading package lists...
    yandex.autogenerated_1: Building dependency tree...
    yandex.autogenerated_1: Reading state information...
    yandex.autogenerated_1: The following additional packages will be installed:
    yandex.autogenerated_1:   apache2-bin apache2-data apache2-utils bzip2 libapr1 libaprutil1
    yandex.autogenerated_1:   libaprutil1-dbd-sqlite3 libaprutil1-ldap liblua5.3-0 mailcap mime-support
    yandex.autogenerated_1:   ssl-cert
    yandex.autogenerated_1: Suggested packages:
    yandex.autogenerated_1:   apache2-doc apache2-suexec-pristine | apache2-suexec-custom www-browser
    yandex.autogenerated_1:   bzip2-doc
    yandex.autogenerated_1: The following NEW packages will be installed:
    yandex.autogenerated_1:   apache2 apache2-bin apache2-data apache2-utils bzip2 libapr1 libaprutil1
    yandex.autogenerated_1:   libaprutil1-dbd-sqlite3 libaprutil1-ldap liblua5.3-0 mailcap mime-support
    yandex.autogenerated_1:   ssl-cert
    yandex.autogenerated_1: 0 upgraded, 13 newly installed, 0 to remove and 10 not upgraded.
    yandex.autogenerated_1: Need to get 2,139 kB of archives.
    yandex.autogenerated_1: After this operation, 8,521 kB of additional disk space will be used.
    yandex.autogenerated_1: Get:1 http://mirror.yandex.ru/ubuntu jammy-updates/main amd64 libapr1 amd64 1.7.0-8ubuntu0.22.04.1 [108 kB]
    yandex.autogenerated_1: Get:2 http://mirror.yandex.ru/ubuntu jammy-updates/main amd64 libaprutil1 amd64 1.6.1-5ubuntu4.22.04.2 [92.8 kB]
    yandex.autogenerated_1: Get:3 http://mirror.yandex.ru/ubuntu jammy-updates/main amd64 libaprutil1-dbd-sqlite3 amd64 1.6.1-5ubuntu4.22.04.2 [11.3 kB]
    yandex.autogenerated_1: Get:4 http://mirror.yandex.ru/ubuntu jammy-updates/main amd64 libaprutil1-ldap amd64 1.6.1-5ubuntu4.22.04.2 [9,170 B]
    yandex.autogenerated_1: Get:5 http://mirror.yandex.ru/ubuntu jammy/main amd64 liblua5.3-0 amd64 5.3.6-1build1 [140 kB]
    yandex.autogenerated_1: Get:6 http://mirror.yandex.ru/ubuntu jammy-updates/main amd64 apache2-bin amd64 2.4.52-1ubuntu4.9 [1,347 kB]
    yandex.autogenerated_1: Get:7 http://mirror.yandex.ru/ubuntu jammy-updates/main amd64 apache2-data all 2.4.52-1ubuntu4.9 [165 kB]
    yandex.autogenerated_1: Get:8 http://mirror.yandex.ru/ubuntu jammy-updates/main amd64 apache2-utils amd64 2.4.52-1ubuntu4.9 [88.7 kB]
    yandex.autogenerated_1: Get:9 http://mirror.yandex.ru/ubuntu jammy/main amd64 mailcap all 3.70+nmu1ubuntu1 [23.8 kB]
    yandex.autogenerated_1: Get:10 http://mirror.yandex.ru/ubuntu jammy/main amd64 mime-support all 3.66 [3,696 B]
    yandex.autogenerated_1: Get:11 http://mirror.yandex.ru/ubuntu jammy-updates/main amd64 apache2 amd64 2.4.52-1ubuntu4.9 [97.9 kB]
    yandex.autogenerated_1: Get:12 http://mirror.yandex.ru/ubuntu jammy/main amd64 bzip2 amd64 1.0.8-5build1 [34.8 kB]
    yandex.autogenerated_1: Get:13 http://mirror.yandex.ru/ubuntu jammy/main amd64 ssl-cert all 1.1.2 [17.4 kB]
==> yandex.autogenerated_1: debconf: unable to initialize frontend: Dialog
==> yandex.autogenerated_1: debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
==> yandex.autogenerated_1: debconf: falling back to frontend: Readline
==> yandex.autogenerated_1: debconf: unable to initialize frontend: Readline
==> yandex.autogenerated_1: debconf: (This frontend requires a controlling tty.)
==> yandex.autogenerated_1: debconf: falling back to frontend: Teletype
==> yandex.autogenerated_1: dpkg-preconfigure: unable to re-open stdin:
    yandex.autogenerated_1: Fetched 2,139 kB in 3s (654 kB/s)
    yandex.autogenerated_1: Selecting previously unselected package libapr1:amd64.
    yandex.autogenerated_1: (Reading database ... 110126 files and directories currently installed.)
    yandex.autogenerated_1: Preparing to unpack .../00-libapr1_1.7.0-8ubuntu0.22.04.1_amd64.deb ...
    yandex.autogenerated_1: Unpacking libapr1:amd64 (1.7.0-8ubuntu0.22.04.1) ...
    yandex.autogenerated_1: Selecting previously unselected package libaprutil1:amd64.
    yandex.autogenerated_1: Preparing to unpack .../01-libaprutil1_1.6.1-5ubuntu4.22.04.2_amd64.deb ...
    yandex.autogenerated_1: Unpacking libaprutil1:amd64 (1.6.1-5ubuntu4.22.04.2) ...
    yandex.autogenerated_1: Selecting previously unselected package libaprutil1-dbd-sqlite3:amd64.
    yandex.autogenerated_1: Preparing to unpack .../02-libaprutil1-dbd-sqlite3_1.6.1-5ubuntu4.22.04.2_amd64.deb ...
    yandex.autogenerated_1: Unpacking libaprutil1-dbd-sqlite3:amd64 (1.6.1-5ubuntu4.22.04.2) ...
    yandex.autogenerated_1: Selecting previously unselected package libaprutil1-ldap:amd64.
    yandex.autogenerated_1: Preparing to unpack .../03-libaprutil1-ldap_1.6.1-5ubuntu4.22.04.2_amd64.deb ...
    yandex.autogenerated_1: Unpacking libaprutil1-ldap:amd64 (1.6.1-5ubuntu4.22.04.2) ...
    yandex.autogenerated_1: Selecting previously unselected package liblua5.3-0:amd64.
    yandex.autogenerated_1: Preparing to unpack .../04-liblua5.3-0_5.3.6-1build1_amd64.deb ...
    yandex.autogenerated_1: Unpacking liblua5.3-0:amd64 (5.3.6-1build1) ...
    yandex.autogenerated_1: Selecting previously unselected package apache2-bin.
    yandex.autogenerated_1: Preparing to unpack .../05-apache2-bin_2.4.52-1ubuntu4.9_amd64.deb ...
    yandex.autogenerated_1: Unpacking apache2-bin (2.4.52-1ubuntu4.9) ...
    yandex.autogenerated_1: Selecting previously unselected package apache2-data.
    yandex.autogenerated_1: Preparing to unpack .../06-apache2-data_2.4.52-1ubuntu4.9_all.deb ...
    yandex.autogenerated_1: Unpacking apache2-data (2.4.52-1ubuntu4.9) ...
    yandex.autogenerated_1: Selecting previously unselected package apache2-utils.
    yandex.autogenerated_1: Preparing to unpack .../07-apache2-utils_2.4.52-1ubuntu4.9_amd64.deb ...
    yandex.autogenerated_1: Unpacking apache2-utils (2.4.52-1ubuntu4.9) ...
    yandex.autogenerated_1: Selecting previously unselected package mailcap.
    yandex.autogenerated_1: Preparing to unpack .../08-mailcap_3.70+nmu1ubuntu1_all.deb ...
    yandex.autogenerated_1: Unpacking mailcap (3.70+nmu1ubuntu1) ...
    yandex.autogenerated_1: Selecting previously unselected package mime-support.
    yandex.autogenerated_1: Preparing to unpack .../09-mime-support_3.66_all.deb ...
    yandex.autogenerated_1: Unpacking mime-support (3.66) ...
    yandex.autogenerated_1: Selecting previously unselected package apache2.
    yandex.autogenerated_1: Preparing to unpack .../10-apache2_2.4.52-1ubuntu4.9_amd64.deb ...
    yandex.autogenerated_1: Unpacking apache2 (2.4.52-1ubuntu4.9) ...
    yandex.autogenerated_1: Selecting previously unselected package bzip2.
    yandex.autogenerated_1: Preparing to unpack .../11-bzip2_1.0.8-5build1_amd64.deb ...
    yandex.autogenerated_1: Unpacking bzip2 (1.0.8-5build1) ...
    yandex.autogenerated_1: Selecting previously unselected package ssl-cert.
    yandex.autogenerated_1: Preparing to unpack .../12-ssl-cert_1.1.2_all.deb ...
    yandex.autogenerated_1: Unpacking ssl-cert (1.1.2) ...
    yandex.autogenerated_1: Setting up libapr1:amd64 (1.7.0-8ubuntu0.22.04.1) ...
    yandex.autogenerated_1: Setting up bzip2 (1.0.8-5build1) ...
    yandex.autogenerated_1: Setting up ssl-cert (1.1.2) ...
    yandex.autogenerated_1: debconf: unable to initialize frontend: Dialog
    yandex.autogenerated_1: debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
    yandex.autogenerated_1: debconf: falling back to frontend: Readline
    yandex.autogenerated_1: Setting up liblua5.3-0:amd64 (5.3.6-1build1) ...
    yandex.autogenerated_1: Setting up apache2-data (2.4.52-1ubuntu4.9) ...
    yandex.autogenerated_1: Setting up mailcap (3.70+nmu1ubuntu1) ...
    yandex.autogenerated_1: Setting up libaprutil1:amd64 (1.6.1-5ubuntu4.22.04.2) ...
    yandex.autogenerated_1: Setting up mime-support (3.66) ...
    yandex.autogenerated_1: Setting up libaprutil1-ldap:amd64 (1.6.1-5ubuntu4.22.04.2) ...
    yandex.autogenerated_1: Setting up libaprutil1-dbd-sqlite3:amd64 (1.6.1-5ubuntu4.22.04.2) ...
    yandex.autogenerated_1: Setting up apache2-utils (2.4.52-1ubuntu4.9) ...
    yandex.autogenerated_1: Setting up apache2-bin (2.4.52-1ubuntu4.9) ...
    yandex.autogenerated_1: Setting up apache2 (2.4.52-1ubuntu4.9) ...
    yandex.autogenerated_1: Enabling module mpm_event.
    yandex.autogenerated_1: Enabling module authz_core.
    yandex.autogenerated_1: Enabling module authz_host.
    yandex.autogenerated_1: Enabling module authn_core.
    yandex.autogenerated_1: Enabling module auth_basic.
    yandex.autogenerated_1: Enabling module access_compat.
    yandex.autogenerated_1: Enabling module authn_file.
    yandex.autogenerated_1: Enabling module authz_user.
    yandex.autogenerated_1: Enabling module alias.
    yandex.autogenerated_1: Enabling module dir.
    yandex.autogenerated_1: Enabling module autoindex.
    yandex.autogenerated_1: Enabling module env.
    yandex.autogenerated_1: Enabling module mime.
    yandex.autogenerated_1: Enabling module negotiation.
    yandex.autogenerated_1: Enabling module setenvif.
    yandex.autogenerated_1: Enabling module filter.
    yandex.autogenerated_1: Enabling module deflate.
    yandex.autogenerated_1: Enabling module status.
    yandex.autogenerated_1: Enabling module reqtimeout.
    yandex.autogenerated_1: Enabling conf charset.
    yandex.autogenerated_1: Enabling conf localized-error-pages.
    yandex.autogenerated_1: Enabling conf other-vhosts-access-log.
    yandex.autogenerated_1: Enabling conf security.
    yandex.autogenerated_1: Enabling conf serve-cgi-bin.
    yandex.autogenerated_1: Enabling site 000-default.
    yandex.autogenerated_1: Created symlink /etc/systemd/system/multi-user.target.wants/apache2.service → /lib/systemd/system/apache2.service.
    yandex.autogenerated_1: Created symlink /etc/systemd/system/multi-user.target.wants/apache-htcacheclean.service → /lib/systemd/system/apache-htcacheclean.service.
    yandex.autogenerated_1: Processing triggers for ufw (0.36.1-4ubuntu0.1) ...
    yandex.autogenerated_1: Processing triggers for man-db (2.10.2-1) ...
    yandex.autogenerated_1: Processing triggers for libc-bin (2.35-0ubuntu3.8) ...
    yandex.autogenerated_1:
    yandex.autogenerated_1: Running kernel seems to be up-to-date.
    yandex.autogenerated_1:
    yandex.autogenerated_1: No services need to be restarted.
    yandex.autogenerated_1:
    yandex.autogenerated_1: No containers need to be restarted.
    yandex.autogenerated_1:
    yandex.autogenerated_1: No user sessions are running outdated binaries.
    yandex.autogenerated_1:
    yandex.autogenerated_1: No VM guests are running outdated hypervisor (qemu) binaries on this host.
    yandex.autogenerated_1: <html><body><h1>Hello, World!</h1></body></html>
==> yandex.autogenerated_1: Stopping instance...
==> yandex.autogenerated_1: Deleting instance...
    yandex.autogenerated_1: Instance has been deleted!
==> yandex.autogenerated_1: Creating image: my-ws-hello-image
==> yandex.autogenerated_1: Waiting for image to complete...
==> yandex.autogenerated_1: Success image create...
==> yandex.autogenerated_1: Destroying subnet...
    yandex.autogenerated_1: Subnet has been deleted!
==> yandex.autogenerated_1: Destroying network...
    yandex.autogenerated_1: Network has been deleted!
==> yandex.autogenerated_1: Destroying boot disk...
    yandex.autogenerated_1: Disk has been deleted!
Build 'yandex.autogenerated_1' finished after 5 minutes 9 seconds.

==> Wait completed after 5 minutes 9 seconds

==> Builds finished. The artifacts of successful builds are:
--> yandex.autogenerated_1: A disk image was created: my-ws-hello-image (id: fd8pgf9cgv4gvnr76pef) with family name my-ws-hello-family
aleksey@first:~/OtusTeam/IaC/les02/webserver$ ./create_vm.sh fd8pgf9cgv4gvnr76pef
Image ID=fd8pgf9cgv4gvnr76pef will be used to create VM
done (1m55s)
id: fhmt7nlt5tbkjlchhjm3
folder_id: b1gmesrdjgklgkvcp704
created_at: "2024-07-03T07:46:08Z"
name: test
zone_id: ru-central1-a
platform_id: standard-v2
resources:
  memory: "2147483648"
  cores: "2"
  core_fraction: "20"
status: RUNNING
metadata_options:
  gce_http_endpoint: ENABLED
  aws_v1_http_endpoint: ENABLED
  gce_http_token: ENABLED
  aws_v1_http_token: DISABLED
boot_disk:
  mode: READ_WRITE
  device_name: fhmgnuljsi7tn6ltueid
  auto_delete: true
  disk_id: fhmgnuljsi7tn6ltueid
network_interfaces:
  - index: "0"
    mac_address: d0:0d:1d:3d:eb:d2
    subnet_id: e9bop98iu12teftg4uj8
    primary_v4_address:
      address: 10.128.0.27
      one_to_one_nat:
        address: 178.154.240.195
        ip_version: IPV4
serial_port_settings:
  ssh_authorization: INSTANCE_METADATA
gpu_settings: {}
fqdn: test.ru-central1.internal
scheduling_policy: {}
network_settings:
  type: STANDARD
placement_policy: {}

aleksey@first:~/OtusTeam/IaC/les02/webserver$ ping 178.154.240.195
PING 178.154.240.195 (178.154.240.195) 56(84) bytes of data.
64 bytes from 178.154.240.195: icmp_seq=1 ttl=60 time=1.01 ms
64 bytes from 178.154.240.195: icmp_seq=2 ttl=60 time=0.439 ms
^C
--- 178.154.240.195 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 0.439/0.723/1.008/0.284 ms
aleksey@first:~/OtusTeam/IaC/les02/webserver$ curl http://178.154.240.195
<html><body><h1>Hello, World!</h1></body></html>
