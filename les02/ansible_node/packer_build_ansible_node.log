aleksey@first:~/OtusTeam/IaC/les02/ansible_node$ packer build ansible_node.json.pkr.hcl 
yandex.autogenerated_1: output will be in this color.

==> yandex.autogenerated_1: Creating temporary RSA SSH key for instance...
==> yandex.autogenerated_1: Using as source image: fd8l04iucc4vsh00rkb1 (name: "ubuntu-22-04-lts-v20240701", family: "ubuntu-2204-lts")
==> yandex.autogenerated_1: Creating network...
==> yandex.autogenerated_1: Creating subnet in zone "ru-central1-a"...
==> yandex.autogenerated_1: Creating disk...
==> yandex.autogenerated_1: Creating instance...
==> yandex.autogenerated_1: Waiting for instance with id fhmeoau9asrjhq7erjek to become active...
    yandex.autogenerated_1: Detected instance IP: 51.250.7.250
==> yandex.autogenerated_1: Using SSH communicator to connect: 51.250.7.250
==> yandex.autogenerated_1: Waiting for SSH to become available...
==> yandex.autogenerated_1: Connected to SSH!
==> yandex.autogenerated_1: Uploading /home/aleksey/.ssh/id_rsa.pub => /tmp/key.pub
    yandex.autogenerated_1: id_rsa.pub 567 B / 567 B [================================================================] 100.00% 0s
==> yandex.autogenerated_1: Provisioning with shell script: /tmp/packer-shell3861544660
==> yandex.autogenerated_1: Stopping instance...
==> yandex.autogenerated_1: Deleting instance...
    yandex.autogenerated_1: Instance has been deleted!
==> yandex.autogenerated_1: Creating image: my-ansible-node-image
==> yandex.autogenerated_1: Waiting for image to complete...
==> yandex.autogenerated_1: Success image create...
==> yandex.autogenerated_1: Destroying subnet...
    yandex.autogenerated_1: Subnet has been deleted!
==> yandex.autogenerated_1: Destroying network...
    yandex.autogenerated_1: Network has been deleted!
==> yandex.autogenerated_1: Destroying boot disk...
    yandex.autogenerated_1: Disk has been deleted!
Build 'yandex.autogenerated_1' finished after 3 minutes 8 seconds.

==> Wait completed after 3 minutes 8 seconds

==> Builds finished. The artifacts of successful builds are:
--> yandex.autogenerated_1: A disk image was created: my-ansible-node-image (id: fd8857mg7fjedvmbs4gj) with family name my-ansible-node-family
aleksey@first:~/OtusTeam/IaC/les02/ansible_node$ ../webserver/create_vm.sh fd8857mg7fjedvmbs4gj
Image ID=fd8857mg7fjedvmbs4gj will be used to create VM
done (1m37s)
id: fhmdhiu0l8un7e53uec9
folder_id: b1gmesrdjgklgkvcp704
created_at: "2024-07-03T08:38:37Z"
name: test
zone_id: ru-central1-a
platform_id: standard-v2
resources:
  memory: "2147483648"
  cores: "2"
  core_fraction: "20"
status: RUNNING
metadata_options:
  gce_http_endpoint: ENABLED
  aws_v1_http_endpoint: ENABLED
  gce_http_token: ENABLED
  aws_v1_http_token: DISABLED
boot_disk:
  mode: READ_WRITE
  device_name: fhmlc0tq7b8ouj990d6u
  auto_delete: true
  disk_id: fhmlc0tq7b8ouj990d6u
network_interfaces:
  - index: "0"
    mac_address: d0:0d:d8:cb:c0:aa
    subnet_id: e9bop98iu12teftg4uj8
    primary_v4_address:
      address: 10.128.0.16
      one_to_one_nat:
        address: 158.160.108.239
        ip_version: IPV4
serial_port_settings:
  ssh_authorization: INSTANCE_METADATA
gpu_settings: {}
fqdn: test.ru-central1.internal
scheduling_policy: {}
network_settings:
  type: STANDARD
placement_policy: {}

aleksey@first:~/OtusTeam/IaC/les02/ansible_node$ ^C
aleksey@first:~/OtusTeam/IaC/les02/ansible_node$ ssh ansible@158.160.108.239
The authenticity of host '158.160.108.239 (158.160.108.239)' can't be established.
ED25519 key fingerprint is SHA256:WWEVYxSeansaOz5TZvJN9okZ5FAbsn1OFoY8d0MoSbk.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '158.160.108.239' (ED25519) to the list of known hosts.
Welcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-113-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Wed Jul  3 09:49:12 AM UTC 2024

  System load:  0.15               Processes:             128
  Usage of /:   20.5% of 19.59GB   Users logged in:       0
  Memory usage: 10%                IPv4 address for eth0: 10.128.0.16
  Swap usage:   0%


Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status



The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

ansible@test:~$ exit
logout
Connection to 158.160.108.239 closed.
aleksey@first:~/OtusTeam/IaC/les02/ansible_node$ ssh ansible@158.160.108.239
Welcome to Ubuntu 22.04.4 LTS (GNU/Linux 5.15.0-113-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Wed Jul  3 09:49:12 AM UTC 2024

  System load:  0.15               Processes:             128
  Usage of /:   20.5% of 19.59GB   Users logged in:       0
  Memory usage: 10%                IPv4 address for eth0: 10.128.0.16
  Swap usage:   0%


Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


Last login: Wed Jul  3 09:49:21 2024 from 51.250.13.236
To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

ansible@test:~$ sudo ls /etc/
adduser.conf		       depmod.d		kernel		mtab		     python3	   sudo.conf
alternatives		       dhcp		landscape	multipath	     python3.10    sudoers
apparmor		       dpkg		ldap		multipath.conf	     rc0.d	   sudoers.d
apparmor.d		       e2scrub.conf	ld.so.cache	nanorc		     rc1.d	   sudo_logsrvd.conf
apport			       environment	ld.so.conf	needrestart	     rc2.d	   sysctl.conf
apt			       ethertypes	ld.so.conf.d	netconfig	     rc3.d	   sysctl.d
bash.bashrc		       fstab		legal		netplan		     rc4.d	   systemd
bash_completion		       fuse.conf	libaudit.conf	network		     rc5.d	   terminfo
bash_completion.d	       fwupd		libblockdev	networkd-dispatcher  rc6.d	   thermald
bindresvport.blacklist	       gai.conf		libnl-3		NetworkManager	     rcS.d	   timezone
binfmt.d		       groff		locale.alias	networks	     resolv.conf   tmpfiles.d
byobu			       group		locale.gen	newt		     rmt	   ubuntu-advantage
ca-certificates		       group-		localtime	nftables.conf	     rpc	   ucf.conf
ca-certificates.conf	       grub.d		logcheck	nsswitch.conf	     rsyslog.conf  udev
ca-certificates.conf.dpkg-old  gshadow		login.defs	opt		     rsyslog.d	   udisks2
cloud			       gshadow-		logrotate.conf	os-release	     screenrc	   ufw
console-setup		       gss		logrotate.d	overlayroot.conf     security	   update-manager
cron.d			       hdparm.conf	lsb-release	PackageKit	     selinux	   update-motd.d
cron.daily		       host.conf	lvm		pam.conf	     services	   update-notifier
cron.hourly		       hostname		machine-id	pam.d		     shadow	   UPower
cron.monthly		       hosts		magic		passwd		     shadow-	   usb_modeswitch.conf
crontab			       hosts.allow	magic.mime	passwd-		     shells	   usb_modeswitch.d
cron.weekly		       hosts.deny	manpath.config	perl		     skel	   vim
cryptsetup-initramfs	       init.d		mdadm		pki		     sos	   vmware-tools
crypttab		       initramfs-tools	mime.types	pm		     ssh	   vtrgb
dbus-1			       inputrc		mke2fs.conf	polkit-1	     ssl	   wgetrc
debconf.conf		       iproute2		ModemManager	pollinate	     subgid	   X11
debian_version		       iscsi		modprobe.d	profile		     subgid-	   xattr.conf
default			       issue		modules		profile.d	     subuid	   xdg
deluser.conf		       issue.net	modules-load.d	protocols	     subuid-	   zsh_command_not_found
ansible@test:~$ sudo ls /etc/sudoers.d
90-cloud-init-users  ansible  README
ansible@test:~$ sudo ls /etc/sudoers.d/ansible
/etc/sudoers.d/ansible
ansible@test:~$ sudo ls -la /etc/sudoers.d/ansible
-r--r----- 1 root root 35 Jul  3 08:29 /etc/sudoers.d/ansible
ansible@test:~$ sudo cat /etc/sudoers.d/ansible
ansible ALL=(ALL:ALL) NOPASSWD:ALL
ansible@test:~$ exit
logout
Connection to 158.160.108.239 closed.
