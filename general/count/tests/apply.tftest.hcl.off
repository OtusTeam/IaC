run "lb_created" {
  command = apply

  assert {
    condition   = length(yandex_lb_network_load_balancer.les04_ylb.listener.*.external_address_spec[0].*.address[0]) > 0
    error_message = "Empty load balancer external ip address"
  }

}

run "website_is_running" {
  command = apply

  module {
    source = "./tests/get"
  }

  variables {
    endpoint = run.lb_created.lb_ip_address
  }

  assert {
    condition     = data.http.index.status_code == 200
    error_message = "Website responded with HTTP status ${data.http.index.status_code}"
  }
}
