terraform {
  required_providers {
    test = {
      source  = "terraform.io/builtin/test"
      version = "~> 0.1"
    }
  }
}

provider "test" {}

module "web" {
  source = "../"

#  providers = {
#    yandex_cloud = yandex_cloud
#  }
}

resource "test_assertions" "web_instances" {
  component = module.web

  checks = [
    {
      description = "Check if the load balancer external ip is not empty"
      condition   = length(module.web.yandex_lb_network_load_balancer.les04_ylb.listener.*.external_address_spec[0].*.address[0]) > 0
    },
    {
      description = "Check if there are 3 web instances"
      condition   = length(module.web.yandex_lb_target_group.les04_web_servers.target) == 3
    }
  ]
}
