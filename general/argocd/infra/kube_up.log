aleksey@first:~/OtusTeam/IaC/general/argocd/infra$ ansible-playbook kube_up.yml 

PLAY [Установка Kubernetes на Ubuntu с использованием Snap] **********************************************************************************************************************************************************************************

TASK [Gathering Facts] ***********************************************************************************************************************************************************************************************************************
ok: [ac-k8s-node-1]
ok: [ac-k8s-master]
ok: [ac-k8s-node-2]

TASK [Обновление пакетов] ********************************************************************************************************************************************************************************************************************
changed: [ac-k8s-node-1]
changed: [ac-k8s-node-2]
changed: [ac-k8s-master]

TASK [Установка необходимых пакетов] *********************************************************************************************************************************************************************************************************
changed: [ac-k8s-node-1]
changed: [ac-k8s-node-2]
changed: [ac-k8s-master]

TASK [Установка необходимых утилит] **********************************************************************************************************************************************************************************************************
changed: [ac-k8s-node-1]
changed: [ac-k8s-master]
changed: [ac-k8s-node-2]

TASK [Download crictl] ***********************************************************************************************************************************************************************************************************************
changed: [ac-k8s-node-2]
changed: [ac-k8s-node-1]
changed: [ac-k8s-master]

TASK [Extract crictl] ************************************************************************************************************************************************************************************************************************
changed: [ac-k8s-node-2]
changed: [ac-k8s-node-1]
changed: [ac-k8s-master]

TASK [Set permissions for crictl] ************************************************************************************************************************************************************************************************************
ok: [ac-k8s-node-2]
ok: [ac-k8s-node-1]
ok: [ac-k8s-master]

TASK [Verify crictl installation] ************************************************************************************************************************************************************************************************************
skipping: [ac-k8s-master]
skipping: [ac-k8s-node-1]
skipping: [ac-k8s-node-2]

TASK [Print crictl version] ******************************************************************************************************************************************************************************************************************
skipping: [ac-k8s-master]
skipping: [ac-k8s-node-1]
skipping: [ac-k8s-node-2]

TASK [Установка snapd] ***********************************************************************************************************************************************************************************************************************
ok: [ac-k8s-node-1]
ok: [ac-k8s-node-2]
ok: [ac-k8s-master]

TASK [Установка kubelet, kubeadm и kubectl через snap] ***************************************************************************************************************************************************************************************
changed: [ac-k8s-node-1] => (item=kubelet)
changed: [ac-k8s-node-2] => (item=kubelet)
changed: [ac-k8s-node-2] => (item=kubeadm)
changed: [ac-k8s-master] => (item=kubelet)
changed: [ac-k8s-node-1] => (item=kubeadm)
changed: [ac-k8s-node-1] => (item=kubectl)
changed: [ac-k8s-node-2] => (item=kubectl)
changed: [ac-k8s-master] => (item=kubeadm)
changed: [ac-k8s-master] => (item=kubectl)

TASK [Отключение swap] ***********************************************************************************************************************************************************************************************************************
skipping: [ac-k8s-master]
skipping: [ac-k8s-node-1]
skipping: [ac-k8s-node-2]

TASK [Удаление записи swap из fstab] *********************************************************************************************************************************************************************************************************
skipping: [ac-k8s-master]
skipping: [ac-k8s-node-1]
skipping: [ac-k8s-node-2]

TASK [Stop the snap.kubelet.daemon service] **************************************************************************************************************************************************************************************************
changed: [ac-k8s-node-1]
changed: [ac-k8s-node-2]
changed: [ac-k8s-master]

TASK [Create kubelet.service file] ***********************************************************************************************************************************************************************************************************
changed: [ac-k8s-node-1]
changed: [ac-k8s-node-2]
changed: [ac-k8s-master]

TASK [Enable kubelet service] ****************************************************************************************************************************************************************************************************************
changed: [ac-k8s-node-1]
changed: [ac-k8s-node-2]
changed: [ac-k8s-master]

TASK [Start kubelet service] *****************************************************************************************************************************************************************************************************************
changed: [ac-k8s-node-1]
changed: [ac-k8s-node-2]
changed: [ac-k8s-master]

TASK [Check kubelet service status] **********************************************************************************************************************************************************************************************************
skipping: [ac-k8s-master]
skipping: [ac-k8s-node-1]
skipping: [ac-k8s-node-2]

TASK [Display kubelet service status] ********************************************************************************************************************************************************************************************************
skipping: [ac-k8s-master]
skipping: [ac-k8s-node-1]
skipping: [ac-k8s-node-2]

TASK [Reload systemd] ************************************************************************************************************************************************************************************************************************
ok: [ac-k8s-node-2]
ok: [ac-k8s-node-1]
ok: [ac-k8s-master]

TASK [Check healthz endpoint] ****************************************************************************************************************************************************************************************************************
ok: [ac-k8s-node-1]
ok: [ac-k8s-node-2]
ok: [ac-k8s-master]

TASK [Check if healthz endpoint returns ok] **************************************************************************************************************************************************************************************************
ok: [ac-k8s-master] => {
    "changed": false,
    "msg": "All assertions passed"
}
ok: [ac-k8s-node-1] => {
    "changed": false,
    "msg": "All assertions passed"
}
ok: [ac-k8s-node-2] => {
    "changed": false,
    "msg": "All assertions passed"
}

PLAY [Инициализация кластера Kubernetes] *****************************************************************************************************************************************************************************************************

TASK [Gathering Facts] ***********************************************************************************************************************************************************************************************************************
ok: [ac-k8s-master]

TASK [Download kube-up.sh script] ************************************************************************************************************************************************************************************************************
changed: [ac-k8s-master]

TASK [Execute kube-up.sh script] *************************************************************************************************************************************************************************************************************
fatal: [ac-k8s-master]: FAILED! => {"changed": true, "cmd": ["/tmp/kube-up.sh"], "delta": "0:00:00.012008", "end": "2024-09-06 16:04:34.004404", "msg": "non-zero return code", "rc": 1, "start": "2024-09-06 16:04:33.992396", "stderr": "/tmp/kube-up.sh: line 33: /tmp/../cluster/kube-util.sh: No such file or directory", "stderr_lines": ["/tmp/kube-up.sh: line 33: /tmp/../cluster/kube-util.sh: No such file or directory"], "stdout": "", "stdout_lines": []}

PLAY RECAP ***********************************************************************************************************************************************************************************************************************************
ac-k8s-master              : ok=18   changed=11   unreachable=0    failed=1    skipped=6    rescued=0    ignored=0   
ac-k8s-node-1              : ok=16   changed=10   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   
ac-k8s-node-2              : ok=16   changed=10   unreachable=0    failed=0    skipped=6    rescued=0    ignored=0   

