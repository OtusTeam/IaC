aleksey@first:~/OtusTeam/IaC/general/argocd/mini/docker$ ansible-playbook nginx1_build_deployment.yml 

PLAY [Build and deploy nginx1 to minikube, run and destroy demo] *****************************************************************************************************************************************************************

TASK [Gathering Facts] ***********************************************************************************************************************************************************************************************************
ok: [ac-mini-docker]

TASK [Check the status of minikube.] *********************************************************************************************************************************************************************************************
ok: [ac-mini-docker]

TASK [Start minikube if it's not running.] ***************************************************************************************************************************************************************************************
skipping: [ac-mini-docker]

TASK [Delete Nginx existing service and deployment] ******************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [Wait for 5 seconds] ********************************************************************************************************************************************************************************************************
Pausing for 5 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [ac-mini-docker]

TASK [Remove existing Nginx image] ***********************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [Create index.html from template on remote host] ****************************************************************************************************************************************************************************
ok: [ac-mini-docker]

TASK [Copy nginx.conf to remote host] ********************************************************************************************************************************************************************************************
ok: [ac-mini-docker]

TASK [Copy Dockerfile to remote host] ********************************************************************************************************************************************************************************************
ok: [ac-mini-docker]

TASK [Build Nginx image] *********************************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [Create Nginx deployment] ***************************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [Wait for 15 seconds] *******************************************************************************************************************************************************************************************************
Pausing for 15 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [ac-mini-docker]

TASK [Get Nginx deployment info] *************************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [debug] *********************************************************************************************************************************************************************************************************************
ok: [ac-mini-docker] => {
    "deployment_info.stdout_lines": [
        "NAME     READY   UP-TO-DATE   AVAILABLE   AGE",
        "nginx1   1/1     1            1           17s"
    ]
}

TASK [Get Nginx pod info] ********************************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [debug] *********************************************************************************************************************************************************************************************************************
ok: [ac-mini-docker] => {
    "pod_info.stdout_lines": [
        "NAME                       READY   STATUS    RESTARTS      AGE",
        "balanced-84cc8c47b-f5lng   1/1     Running   7 (21h ago)   8d",
        "bar-app                    1/1     Running   7 (21h ago)   8d",
        "foo-app                    1/1     Running   7 (21h ago)   8d",
        "nginx-bf5d5cf98-c6hx8      1/1     Running   1 (21h ago)   39h",
        "nginx1-7bb68ffbbc-ckkm5    1/1     Running   0             17s"
    ]
}

TASK [Get services info] *********************************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [debug] *********************************************************************************************************************************************************************************************************************
ok: [ac-mini-docker] => {
    "service_info.stdout_lines": [
        "NAME          TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE",
        "balanced      LoadBalancer   10.102.20.175    <pending>     8080:32502/TCP   8d",
        "bar-service   ClusterIP      10.105.171.144   <none>        8080/TCP         8d",
        "foo-service   ClusterIP      10.100.2.159     <none>        8080/TCP         8d",
        "kubernetes    ClusterIP      10.96.0.1        <none>        443/TCP          8d",
        "nginx         NodePort       10.101.4.116     <none>        80:31646/TCP     26h"
    ]
}

TASK [Expose Nginx deployment as NodePort service] *******************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [Get Nginx service info] ****************************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [debug] *********************************************************************************************************************************************************************************************************************
ok: [ac-mini-docker] => {
    "our_service_info.stdout_lines": [
        "NAME     TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE",
        "nginx1   NodePort   10.103.177.0   <none>        80:31312/TCP   1s"
    ]
}

TASK [Wait for 5 seconds] ********************************************************************************************************************************************************************************************************
Pausing for 5 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [ac-mini-docker]

TASK [Test Nginx service] ********************************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [debug] *********************************************************************************************************************************************************************************************************************
ok: [ac-mini-docker] => {
    "test_result.stdout_lines": [
        "<!DOCTYPE html>",
        "<html>",
        "<body>",
        "<h1>Hello</h1>",
        "<p>My IP address is: <script>document.write(\"<b>\" + window.location.hostname + \"</b>\");</script></p>",
        "<p>My name is: nginx1</p>",
        "</body>",
        "</html>"
    ]
}

TASK [Start port forwarding with kubectl] ****************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [Wait for port forwarding to start] *****************************************************************************************************************************************************************************************
Pausing for 2 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [ac-mini-docker]

TASK [Find the port-forward process ID] ******************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [Test Nginx service from Internet] ******************************************************************************************************************************************************************************************
ok: [ac-mini-docker -> localhost]

TASK [debug] *********************************************************************************************************************************************************************************************************************
ok: [ac-mini-docker] => {
    "uri_result_external.content": "<!DOCTYPE html>\n<html>\n<body>\n<h1>Hello</h1>\n<p>My IP address is: <script>document.write(\"<b>\" + window.location.hostname + \"</b>\");</script></p>\n<p>My name is: nginx1</p>\n</body>\n</html>\n"
}

TASK [Kill the port-forward process] *********************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [Delete Nginx existing service and deployment] ******************************************************************************************************************************************************************************
changed: [ac-mini-docker]

TASK [Wait for 5 seconds] ********************************************************************************************************************************************************************************************************
Pausing for 5 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [ac-mini-docker]

TASK [Remove existing Nginx image] ***********************************************************************************************************************************************************************************************
changed: [ac-mini-docker]

PLAY RECAP ***********************************************************************************************************************************************************************************************************************
ac-mini-docker             : ok=32   changed=15   unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   

